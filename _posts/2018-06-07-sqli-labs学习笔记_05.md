---
title: sqli-labs学习笔记_05
categories:
- sqli-labs
tags:
- sql注入
updated: 2018-06-07
---

**第五节：GET - Double Injection - Single Quotes - String** (双注入GET单引号字符型注入)

 

可以在你的php文件中加上一句话:echo "你的sql语句是：

```php+HTML
echo "你的sql语句是：".$sql."<br>";
```

代码如下：

~~~php+HTML
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Less-5 Double Query- Single Quotes- String</title>
</head>

<body bgcolor="#000000">
<div style=" margin-top:60px;color:#FFF; font-size:23px; text-align:center">Welcome&nbsp;&nbsp;&nbsp;<font color="#FF0000"> Dhakkan </font><br>
<font size="3" color="#FFFF00">


<?php
//including the Mysql connect parameters.
include("../sql-connections/sql-connect.php");
error_reporting(0);
// take the variables
if(isset($_GET['id']))
{
$id=$_GET['id'];
//logging the connection parameters to a file for analysis.
$fp=fopen('result.txt','a');
fwrite($fp,'ID:'.$id."\n");
fclose($fp);

// connectivity 


$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";
echo "你的sql语句是：".$sql."<br>";
$result=mysql_query($sql);
$row = mysql_fetch_array($result);

	if($row)
	{
  	echo '<font size="5" color="#FFFF00">';	
  	echo 'You are in...........';
  	echo "<br>";
    	echo "</font>";
  	}
	else 
	{
	
	echo '<font size="3" color="#FFFF00">';
	print_r(mysql_error());
	echo "</br></font>";	
	echo '<font color= "#0000ff" font size= 3>';	
	
	}
}
	else { echo "Please input the ID as parameter with numeric value";}

?>

</font> </div></br></br></br><center>
<img src="../images/Less-5.jpg" /></center>
</body>
</html>

~~~



 当使用http://127.0.0.1/Less-5/?id=1的时候：

<img src="{{ site.url }}/assets//blog_images/sqli-labs_05_01.png" />

出现了和上面4个不一样的，没有正常的输出用户名和密码。

代码块：

```php+HTML
if($row)
	{
  	echo '<font size="5" color="#FFFF00">';	
  	echo 'You are in...........';
  	echo "<br>";
    	echo "</font>";
  	}
```

就没有输出$row的结果。。。。。

百度大神的有：双查询注入顾名思义形式上是两个嵌套的查询，即select ...(select ...)，里面的那个select被称为子查询，他的执行顺序也是先执行子查询，然后再执行外面的select，双注入主要涉及到了几个sql函数：

rand()随机函数，返回0~1之间的某个值

floor(a)取整函数，返回小于等于a，且值最接近a的一个整数

count()聚合函数也称作计数函数，返回查询对象的总数

group by cluase分组语句，按照cluase对查询结果分组

如果还是不懂可以看此链接：<http://www.2cto.com/article/201303/192718.html>

双注入的原理总的来说就是，当一个聚合函数后面出现group分组语句时，会将查询的一部分结果以报错的形式返回，他有一个固定的公式。 那么开始构建sql语句：

 `http://127.0.0.1/Less-5/?id=-1' union select count(*),2,concat('*',(select database()),'*',floor(rand()*2))as a from information_schema.tables group by a--+`



<img src="{{ site.url }}/assets//blog_images/sqli-labs_05_02.png" />

通过改变 limit 的值就可以遍历用户信息 

sql注入比较难，中间有很多的坑，都是慢慢来的，比如 --+  有时候会不小心写成—+  或者是少了）之类的，一定要有耐心



<img src="{{ site.url }}/assets//blog_images/sqli-labs_04_04.png" />



(个人学习笔记，部分转自互联网)













 








