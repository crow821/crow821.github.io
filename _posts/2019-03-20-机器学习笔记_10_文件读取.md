---
title: 机器学习笔记_10_文件读取
categories:
- ML
tags:
- tensorflow
updated: 2019-03-20
---



 

笔记来源：培训视频       tensorflow_文件读取



<img src="{{ site.url }}/assets//blog_images/ML/文件读取_01.png" />

**tensorflow队列**

 在训练样本的时候，希望读入的训练样本是有序的：

tf.FIFOQueue 先进先出，按顺序出队列

tf.RandomShuffleQueue 随机出队列

<img src="{{ site.url }}/assets//blog_images/ML/文件读取_02.png" />



```python
# coding: utf-8
import tensorflow as tf

# 模拟一下同步先处理数据，然后才能取数据训练

# 1.首先定义一个队列
Q = tf.FIFOQueue(3,tf.float32)

# 放入一些数据
enq_many = Q.enqueue_many([[0.1, 0.2, 0.3], ])

# 2.定义一些读取数据，取数据的过程  去数据， +1， 如队列

out_q = Q.dequeue()

data = out_q + 1

en_q = Q.enqueue(data)



with tf.Session() as sess:
    # 初始化队列
    sess.run(enq_many)

    # 处理数据
    for i in range(100):
        sess.run(en_q)
    # 训练数据
    for i in range(Q.size().eval()):
        print(sess.run(Q.dequeue()))
"""
33.2
33.3
34.1
"""
```

队列管理器：

<img src="{{ site.url }}/assets//blog_images/ML/文件读取_03.png" />

线程协调器：

<img src="{{ site.url }}/assets//blog_images/ML/文件读取_04.png" />

```python
# coding: utf-8
import tensorflow as tf
import os
"""
# 模拟一下同步先处理数据，然后才能取数据训练

# 1.首先定义一个队列
Q = tf.FIFOQueue(3,tf.float32)

# 放入一些数据
enq_many = Q.enqueue_many([[0.1, 0.2, 0.3], ])

# 2.定义一些读取数据，取数据的过程  去数据， +1， 如队列

out_q = Q.dequeue()

data = out_q + 1

en_q = Q.enqueue(data)



with tf.Session() as sess:
    # 初始化队列
    sess.run(enq_many)

    # 处理数据
    for i in range(100):
        sess.run(en_q)
    # 训练数据
    for i in range(Q.size().eval()):
        print(sess.run(Q.dequeue()))
"""
# 1.定义一个队列，1000
Q = tf.FIFOQueue(1000, tf.float32)

# 2.定义要做的事情，循环值 +1, 放入队列当中
var = tf.Variable(0.0)

# 实现一个自增， tf.assign_add
data = tf.assign_add(var, tf.constant(1.0))

en_q = Q.enqueue(data)


# 3.定义队列管理器op，指定多少个子线程，子线程该干什么事情
qr = tf.train.QueueRunner(Q, enqueue_ops=[en_q] *2)
# 初始化变量的OP
init_op = tf.global_variables_initializer()

with tf.Session() as sess:
    sess.run(init_op)
    # 开启线程管理器
    coord = tf.train.Coordinator()
    # 真正开启子线程
    threads = qr.create_threads(sess, coord=coord,start=True)
    # 主线程，不断读取训练数据
    for i in range(300):
        print(sess.run(Q.dequeue()))
    # 回收
    coord.request_stop()

    coord.join(threads)

```

**文件读取流程：**



<img src="{{ site.url }}/assets//blog_images/ML/文件读取_05.png" />



文件读取队API-文件队列构造：

<img src="{{ site.url }}/assets//blog_images/ML/文件读取_06.png" />

文件读取API-文件阅读器：

<img src="{{ site.url }}/assets//blog_images/ML/文件读取_07.png" />

文件读取API-文件内容解码器：

<img src="{{ site.url }}/assets//blog_images/ML/文件读取_08.png" />











